<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboards</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="./js/loading.js"></script>
    <script src="./js/sessao.js"></script>
</head>

<body onload="carregarGraficoBarra(), validarSessao()">

    <div id="TelaLoading">
        <img src="assets/imgs/img-loading-a-230203.gif" alt="Loading...">
    </div>
    <div id="TelaLoading">
        <img src="assets/imgs/img-loading-a-230203.gif" alt="Loading...">
    </div>
    <div id="main-header">
        <div class="nav-container">
            <div class="div_esquerda">
                <div>
                    <a href="../index.html"><img src="../assets/sea-of-stars-logo.png"></a>
                </div>
            </div>

            <div class="div_direita">
                <a href="./linha-do-tempo.html">Timeline</a>
                <span>|</span>
                <a href="#">Dashboards</a>
                <span>|</span>
                <a href="../HomePage.html" onclick="sair()">Sair</a>
            </div>
        </div>
    </div>

    <div class="banner">
        <button onclick="iniciarQuiz()">Iniciar Quiz</button>
    </div>

    <div class="dashboards">
        <div class="grafico">
            <h1 class="tituloGrafico">Desempenho no quiz</h1>
            <canvas id="desempenhoBarra" style="height:100%; width:40vw; min-width: 40vw; min-height: 60vh;"></canvas>
        </div>

        <div class="grafico">
            <h1 class="tituloGrafico">Gráfico linha do tempo</h1>
            <div>
                Em produção
            </div>
            <canvas id="" style="height:408px; width:40vw; min-width: 40vw; min-height: 60vh;"></canvas>
        </div>
    </div>

    <div class="footer">
        <div class="containerFooter">
            <h4>Feito por Guilherme Barros --- Sptech 2025</h4>
        </div>

    </div>

</body>
<script>
    const idUsuario = sessionStorage.ID_USUARIO;

    console.log('Id: ', idUsuario);
    

    function sair() {
        mostrarTelaLoading();
        limparSessao()
        window.location = "HomePage.html";
    }

    function iniciarQuiz() {
        mostrarTelaLoading();
        window.location = "quiz.html";
    }

    function ultimoResultado() {

        fetch(`/dashboard/ultimo/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos (ultimoResultado ${idUsuario}): ${JSON.stringify(resposta)}`);
                    });
                } else {
                    console.error(`Nenhum dado encontrado ou erro na API para ultimoResultado ${idUsuario}. Status: ${response.status}`);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados para ultimoResultado ${idUsuario}: ${error.message}`);
            });
    }

    function melhorResultado() {

        fetch(`/dashboard/melhor/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos (melhorResultado ${idUsuario}): ${JSON.stringify(resposta)}`);
                    });
                } else {
                    console.error(`Nenhum dado encontrado ou erro na API para melhorResultado ${idUsuario}. Status: ${response.status}`);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados para melhorResultado ${idUsuario}: ${error.message}`);
            });
    }

    function mediaResultadosIndividual() {

        fetch(`/dashboard/mediaIndividual/${idUsuario}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos (mediaIndividual ${idUsuario}): ${JSON.stringify(resposta)}`);
                    });
                } else {
                    console.error(`Nenhum dado encontrado ou erro na API para mediaIndividual ${idUsuario}. Status: ${response.status}`);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados para mediaIndividual ${idUsuario}: ${error.message}`);
            });
    }

    function mediaResultadosGeral() {

        fetch(`/dashboard/mediaGeral`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos (mediaGeral): ${JSON.stringify(resposta)}`);
                    });
                } else {
                    console.error(`Nenhum dado encontrado ou erro na API para mediaGeral. Status: ${response.status}`);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados para mediaGeral: ${error.message}`);
            });
    }


    function carregarGraficoBarra() {
        

        const canvas = document.getElementById('desempenhoBarra');

        const labels = ['Nota Atual', 'Penúltima Nota', 'Média Individual', 'Média Geral'];
        const dados = [ultimoResultado, melhorResultado, mediaIndividual, mediaGeral];

        canvas.style.display = 'block';

        if (window.myChartInstance) {
            window.myChartInstance.destroy();
        }

        window.myChartInstance = new Chart(canvas, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Pontuação Quiz',
                    data: dados,
                    backgroundColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(255, 159, 64, 1)',
                        'rgba(255, 205, 86, 1)',
                        'rgba(75, 192, 192, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                legend: {
                    display: true,
                    hei: 30,
                    position: 'top',
                },
                title: {
                    display: false,
                    text: 'Desempenho no Quiz'
                },
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                        }
                    }],
                    xAxes: [{
                        ticks: {}
                    }]
                }
            }
        });

    }


</script>

</html>